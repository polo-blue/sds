---
import type { Author, Category } from '../types';
import PostCategories from '../../Post/PostCategories.astro';
import Date from '../../Date.astro';
import { Image } from 'astro:assets';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  imageWidth?: number;
  imageHeight?: number;
  imageClass?: string;
  author?: Author;
  date?: string;
  categories?: Category[];
  hasMetadata: boolean;
  hasCategories: boolean;
  lang: string;
  fullWidth?: boolean;
  align?: 'left' | 'center' | 'right';
  split?: 'equal' | 'wide';
  slim?: boolean;
}

// Note: imageClass allows responsive image sizing via Tailwind/UnoCSS classes
// Example: imageClass="max-w-100 lg:max-w-80" for responsive max-width control

const {
  title = '',
  description,
  image,
  imageWidth = 768,
  imageHeight = 432,
  imageClass,
  author,
  date,
  categories = [],
  hasMetadata,
  hasCategories,
  lang = 'en',
  fullWidth = false,
  align = 'left',
  split = 'equal',
  slim = false,
} = Astro.props;

// Grid classes based on split prop
// equal = 50/50, wide = 2/3 text + 1/3 image
const splitClasses = {
  equal: 'jumbotron-split-header',
  wide: 'jumbotron-split-header jumbotron-split-header-wide',
};
const splitClass = splitClasses[split];

// Alignment determines content and image position
// align="left" = content left, image right (default)
// align="center" = both centered
// align="right" = content right, image left

// Content wrapper margin classes
const contentMarginClasses = {
  left: 'mr-auto',
  center: 'mx-auto text-center',
  right: 'ml-auto text-right',
};
const contentMarginClass = contentMarginClasses[align];

// Image is always aligned to the right
const imageWrapperClass = 'ml-auto';

// Helper function to remove HTML tags
const stripHtml = (html: string) => {
  return html.replace(/<[^>]*>/g, '');
};

// Get clean title for alt attribute
const cleanTitle = stripHtml(title);
---

<div class:list={['jumbotron-split-wrapper bg-blue-900 bg-vw', { 'full-width-block': fullWidth }]}>
  <div class="jumbotron-split-container">
    <header class:list={[splitClass, { 'jumbotron-split-header-slim': slim }]}>
      <div class="heading flex flex-wrap text-white relative items-center mt-auto w-full z-[2]">
        <div
          class:list={[
            'jumbotron-split-content',
            contentMarginClass,
            { 'jumbotron-split-content-slim': slim },
          ]}
        >
          <h1 class="jumbotron-split-title" set:html={title} />

          {description && <p class="jumbotron-description order-3 w-full mt-0" set:html={description} />}

          {
            hasCategories && (
              <div class="jumbotron-categories">
                <PostCategories categories={categories} lang={lang} />
              </div>
            )
          }

          {
            hasMetadata && (
              <div class="jumbotron-split-meta">
                {author && (
                  <span class="text-sm" title={author.firstName} data-pagefind-ignore>
                    {author.name}
                  </span>
                )}
                {author && date && <span class="mx-1">-</span>}
                {date && <Date date={date} />}
              </div>
            )
          }
        </div>
      </div>

      {
        image && (
          <div
            class:list={[
              'jumbotron-split-image-wrapper',
              imageWrapperClass,
              { 'jumbotron-split-image-wrapper-slim': slim },
            ]}
          >
            <div class:list={['jumbotron-split-image', imageClass, { 'jumbotron-split-image-slim': slim }]}>
              <Image
                class="jumbotron-split-img"
                src={image}
                alt={cleanTitle}
                width={imageWidth}
                height={imageHeight}
                loading="eager"
              />
            </div>
          </div>
        )
      }
    </header>
  </div>
</div>

<style scoped>
  .jumbotron-split-title {
    b {
      font-family: 'vw_headregular', sans-serif;
    }
  }
</style>
